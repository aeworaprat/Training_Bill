<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>
<body>
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    td, th {
        border: 1px solid #262626;
        text-align: left;
        padding: 8px;
    }
</style>
    <div class="container">
        <a href="../index.html">กลับ</a>
        <h2>จัดการบิล</h2>
        <br><br>
        <table id="table">
            <thead>
                <tr>
                    <th width='5%'>No.</th>
                    <th width='15%'>รหัสบิล</th>
                    <th width='15%'>วันที่</th>
                    <th width=>ราคารามสุทธิ</th>
                    <th width='20%' style='text-align:center'>ดำเนินการ</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <template id="receipt_template">
            <td class="num"></td>
            <td class="code"></td>
            <td class="date"></td>
            <td class="price" style='text-align: right'></td>
            <td style='text-align:center'>
            <button class="view">ดู</button>
            </td>
        </template>
    </div>
    <script type="module">
    import { GetAllReceipt } from '../api.js'
    window.addEventListener('DOMContentLoaded', (event) => {
        GetAll();
    });

    async function GetAll()
    {
        const result = await GetAllReceipt();
        CreateTable(result);
    }

    function CreateTable(data)
    {
        const table = document.querySelector("#table tbody")
        table.innerHTML = ''
        const template = document.getElementById("receipt_template");
        
        data.forEach((row, index) => {
            const tr = document.createElement("tr")
            const template_clone = template.content.cloneNode(true);
            template_clone.querySelector('.num').innerText = index+1
            template_clone.querySelector('.code').innerText = row.receipt_code
            template_clone.querySelector('.date').innerText = row.receipt_date
            template_clone.querySelector('.price').innerText = row.receipt_total_price.toFixed(2)
            template_clone.querySelector('.price').innerText
            template_clone.querySelector('.view').addEventListener('click', function(){ ViewReceipt(row.receipt_id) })
            tr.appendChild(template_clone);
            table.appendChild(tr);
        })
    }

    function ViewReceipt(id){
        window.location.href = "v_receipt_info.html?id="+id;
    }

    </script>
    </body>
</html>